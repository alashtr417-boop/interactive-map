<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ø®Ø§Ø±Ø·Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body { margin:0; font-family: "Segoe UI", Arial; }
#map { height:100vh; width:100%; }

/* Ø²Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª */
#uploadBox {
  position: absolute;
  top: 15px;
  left: 15px;
  z-index: 9999;
  background: white;
  padding: 10px 14px;
  border-radius: 10px;
  box-shadow: 0 0 8px #0003;
}
#uploadBox label {
  font-weight: bold;
  color: #0066cc;
  cursor: pointer;
}
</style>
</head>

<body>

<div id="uploadBox">
  <label>ğŸ“ Ø±ÙØ¹ Ù…Ù„Ù GeoJSON Ø¬Ø¯ÙŠØ¯:
    <input type="file" id="geoFile" accept=".geojson,.json" style="display:none">
  </label>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù…Ø¹ Google Satellite
var googleSat = L.tileLayer(
  'https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', 
  { attribution: "Google Satellite" }
);

var map = L.map('map', {
    center: [32.5, 44.0],  // Ø§Ù„Ø¹Ø±Ø§Ù‚
    zoom: 7,
    layers: [googleSat]
});

var currentLayer = null;

// Ø¯Ø§Ù„Ø© Ø±Ø³Ù… Ø§Ù„Ø·Ø¨Ù‚Ø©
function loadGeoJSON(data) {
    if (currentLayer) {
        map.removeLayer(currentLayer);
    }

    currentLayer = L.geoJSON(data, {
        style: {
            color: "#ff5500",
            weight: 2,
            fillOpacity: 0.35
        },
        onEachFeature: function(feature, layer) {

            let popupHtml = "<h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…</h4>";
            popupHtml += "<table>";

            for (let key in feature.properties) {
                popupHtml += `
                    <tr>
                      <td><b>${key}</b></td>
                      <td>${feature.properties[key]}</td>
                    </tr>`;
            }

            popupHtml += "</table>";
            layer.bindPopup(popupHtml);
        }
    }).addTo(map);

    map.fitBounds(currentLayer.getBounds());
}

// Ø±ÙØ¹ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²
document.getElementById("geoFile").addEventListener("change", function(event) {
    let file = event.target.files[0];
    let reader = new FileReader();
    reader.onload = function(e) {
        try {
            let json = JSON.parse(e.target.result);
            loadGeoJSON(json);
        } catch (err) {
            alert("âŒ Ø®Ø·Ø£: Ù…Ù„Ù GeoJSON ØºÙŠØ± ØµØ§Ù„Ø­");
        }
    };
    reader.readAsText(file);
});

// ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù GeoJSON Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
fetch("data.geojson")
.then(res => res.json())
.then(json => loadGeoJSON(json))
.catch(() => console.log("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù data.geojson"));

</script>
</body>
</html>
